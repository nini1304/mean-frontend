<div class="ag-page">
    <div class="ag-shell">
        <div class="ag-top">
            <div>
                <div class="ag-kicker">Agenda</div>
                <h1 class="ag-title">Citas y calendario</h1>
                <p class="ag-sub">Gestiona las citas por día, semana o mes.</p>
            </div>

            <div class="ag-actions">
                <span class="ag-pill" *ngIf="cargando">Cargando…</span>
                <span class="ag-pill err" *ngIf="!cargando && errorMsg">{{
                    errorMsg }}</span>
            </div>
        </div>
        <div class="ag-filters">
            <label class="ag-label">Veterinario</label>

            <select class="ag-select"
                [disabled]="cargandoVets"
                [(ngModel)]="idVeterinario"
                (ngModelChange)="onVeterinarioChange($event)">
                <option value>-- Selecciona --</option>
                <option *ngFor="let v of vets" [value]="v.id">
                    {{ v.usuario.nombre_completo }} · {{ v.especialidad }}
                </option>
            </select>

        </div>

        <div class="ag-card">
            <full-calendar [options]="calendarOptions"></full-calendar>
            <!-- Modal detalle de cita -->
            <div class="ag-modal-backdrop" *ngIf="showDetalle"
                (click)="cerrarDetalle()">
                <div class="ag-modal" (click)="$event.stopPropagation()">
                    <div class="ag-modal-top">
                        <div>
                            <div class="ag-modal-kicker">Detalle de cita</div>
                            <div class="ag-modal-title">
                                {{ citaSeleccionada?.tipo }} · {{
                                citaSeleccionada?.estado }}
                            </div>
                        </div>

                        <button class="ag-x" type="button"
                            (click)="cerrarDetalle()">×</button>
                    </div>

                    <div class="ag-modal-body" *ngIf="citaSeleccionada as c">
                        <div class="ag-row">
                            <span class="k">Motivo</span>
                            <span class="v">{{ c.motivo || '-' }}</span>
                        </div>

                        <div class="ag-row">
                            <span class="k">Inicio</span>
                            <span class="v">{{ formatDate(c.start) }}</span>
                        </div>

                        <div class="ag-row">
                            <span class="k">Fin</span>
                            <span class="v">{{ formatDate(c.end) }}</span>
                        </div>

                        <div class="ag-row">
                            <span class="k">Veterinario</span>
                            <span class="v">
                                {{ getVetNombre(c) }}
                                <span *ngIf="getVetEspecialidad(c)"> · {{
                                    getVetEspecialidad(c) }}</span>
                            </span>
                        </div>

                        <div class="ag-row">
                            <span class="k">Mascota</span>
                            <span class="v">
                                {{ getMascotaNombre(c) }}
                                <span *ngIf="getMascotaTipo(c)"> · {{
                                    getMascotaTipo(c) }}</span>
                            </span>
                        </div>

                        <div class="ag-row">
                            <span class="k">Dueño</span>
                            <span class="v">{{ c.dueno?.nombre_completo || '-'
                                }}</span>
                        </div>

                        <div class="ag-modal-actions">
                            <!-- ejemplo: cancelar -->
                            <button class="ag-btn danger" type="button"
                                (click)="cancelarDesdeModal(c._id)">
                                Cancelar cita
                            </button>
                            <button class="ag-btn" type="button"
                                (click)="cerrarDetalle()">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
