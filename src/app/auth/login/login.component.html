<div class="login-page">
  <div class="login-card">
    <!-- Gatito -->
    <img
      src="/assets/cat-login.svg"
      alt="Gatito"
      class="cat-image" />

    <!-- Contenido del formulario -->
    <div class="login-content">
      <h1 class="login-title">Iniciar Sesión</h1>

      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
        <!-- Correo -->
        <div class="form-group">
          <label for="correo">Correo:</label>
          <input
            id="correo"
            type="email"
            formControlName="correo"
            [class.is-invalid]="f['correo'].invalid && f['correo'].touched" />
        </div>

        <!-- Contraseña -->
        <div class="form-group">
          <label for="contrasena">Contraseña:</label>
          <input
            id="contrasena"
            type="password"
            formControlName="contrasena"
            [class.is-invalid]="
              f['contrasena'].invalid && f['contrasena'].touched
            " />
        </div>

        <!-- Mensajes -->
        <div class="messages">
          <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
          <p class="warning"
            *ngIf="intentosRestantes !== null && intentosRestantes > 0">
            Te quedan {{ intentosRestantes }} intento(s) antes de bloquear tu
            cuenta.
          </p>
          <p class="success" *ngIf="successMsg">{{ successMsg }}</p>
        </div>

        <!-- Botón -->
        <button type="submit" class="btn-primary"
          [disabled]="cargando || bloqueado">
          {{ cargando ? 'Ingresando...' : 'Ingresar' }}
        </button>

      </form>

      <!-- Recuperar contraseña -->
      <button
        type="button"
        class="recover-link"
        (click)="onRecoverPassword()">
        Recuperar contraseña
      </button>
    </div>
  </div>

  <!-- MODAL RECUPERAR CONTRASEÑA -->
  <div class="modal-backdrop" *ngIf="showRecoverModal">
    <div class="modal-card">
      <button class="modal-close" type="button" (click)="closeRecoverModal()">
        ✕
      </button>

      <h2 class="modal-title">Recuperar Contraseña</h2>

      <p class="modal-text">
        Se enviará una contraseña generada automáticamente a su correo
        registrado. Una vez recibida, inicie sesión y proceda a cambiarla.
      </p>

      <form
        [formGroup]="recoverForm"
        (ngSubmit)="submitRecoverPassword()"
        class="modal-form">
        <div class="modal-form-group">
          <label for="recuperar-correo">Ingrese su correo:</label>
          <input
            id="recuperar-correo"
            type="email"
            formControlName="correo"
            [class.is-invalid]="rf['correo'].invalid && rf['correo'].touched" />
        </div>

        <div class="modal-messages">
          <p class="error" *ngIf="resetErrorMsg">{{ resetErrorMsg }}</p>
          <p class="success" *ngIf="resetMsg">{{ resetMsg }}</p>
        </div>

        <button
          type="submit"
          class="btn-primary modal-btn"
          [disabled]="cargandoReset">
          {{ cargandoReset ? 'Enviando...' : 'Enviar' }}
        </button>
      </form>
    </div>
  </div>

  <!-- MODAL RESTABLECER CONTRASEÑA -->
  <div class="modal-backdrop" *ngIf="showChangePasswordModal">
    <div class="modal-card">
      <!-- opcional: si NO quieres que pueda cerrarlo, quita este botón -->
      <button class="modal-close" type="button"
        (click)="closeChangePasswordModal()">
        ✕
      </button>

      <h2 class="modal-title">Restablecer Contraseña</h2>

      <form
        [formGroup]="changePasswordForm"
        (ngSubmit)="submitChangePassword()"
        class="modal-form">
        <div class="modal-form-group">
          <label for="new-pass">Ingrese su nueva contraseña:</label>
          <input
            id="new-pass"
            type="password"
            formControlName="contrasena_nueva"
            [class.is-invalid]="cpf['contrasena_nueva'].invalid && cpf['contrasena_nueva'].touched" />
        </div>

        <div class="modal-form-group">
          <label for="new-pass-2">Repita su nueva contraseña:</label>
          <input
            id="new-pass-2"
            type="password"
            formControlName="contrasena_nueva_2"
            [class.is-invalid]="cpf['contrasena_nueva_2'].invalid && cpf['contrasena_nueva_2'].touched" />
        </div>

        <div class="modal-messages">
          <p class="error"
            *ngIf="changePasswordForm.hasError('passwordsMismatch') && changePasswordForm.touched">
            Las contraseñas no coinciden.
          </p>

          <p class="error" *ngIf="changeErrorMsg">{{ changeErrorMsg }}</p>
          <p class="success" *ngIf="changeMsg">{{ changeMsg }}</p>
        </div>

        <button type="submit" class="btn-primary modal-btn"
          [disabled]="cargandoChange">
          {{ cargandoChange ? 'Enviando...' : 'Enviar' }}
        </button>
      </form>
    </div>
  </div>

</div>
